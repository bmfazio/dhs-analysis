---
title: "Peru DHS - BMI trend analysis"
author: "Boris M Fazio"
date: "2017-03-30"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
datafdir  <- "C:/Users/bfazio/Desktop/analisis/modlineal/datafiles/"
#ISO 8859-1 encoding
```

## Raw data

Load libraries and the aggregated raw data. If you haven't generated the latter, first do so using [this function](https://github.com/bmfazio/dhs-analysis/blob/master/peru/genfile-BMI.R).

```{r warning=FALSE}
library(magrittr)
library(data.table)

dhs <- fread(datafdir %>% paste0("rawdata.csv"))
str(dhs) #Always good to take a look.
```

## Data cleaning and preparation

For this analysis, the relationship of ethnicity and of residence history with Body Mass Index (BMI) will be explored over the years 2005 to 2015. We first need to construct those variables from the available data.

### Ethnicity

Following the operationalization proposed in (Valdivia 2007), we create three categories (old spanish speakers, recent spanish speakers and indigenous language speakers) based on the following questions asked in the Peru DHS:

* `ethnic_self`: ¿Qué idioma o dialecto hablan habitualmente en su hogar? (*What language or dialect do you normally speak at home?*)
* `ethnic_mom`: ¿Cuál es el idioma o lengua materna de su madre? (*What is your mother's mother tongue?*)
* `ethnic_dad`: ¿Cuál es el idioma o lengua materna de su padre? (*What is your father's mother tongue?*)

Valid answers are *spanish*, *quechua*, *aymara*, *other indigenous language* and *foreign language*.

This set of questions was not asked during before 2005 or in the 2009-2012 surveys, so we exclude those years from this analysis.

```{r}
#1:spanish, 2:quechua, 3:aymara, 4:other indigenous, 5:foreign
dhs[ethnic_self==1&ethnic_dad==1&ethnic_mom==1,ethnic_cat:="old spanish"]
dhs[ethnic_self==1&(is.element(ethnic_dad,2:4)|is.element(ethnic_mom,2:4)),ethnic_cat:="recent spanish"]
dhs[is.element(ethnic_self,2:4),ethnic_cat:="indigenous"]

dhs[!(year%>%is.element(c(2003,2004,2009:2012)))] %>% with(ethnic_cat %>% table(year))
```

Notice we categorize respondents as `"indigenous"` without using their parent's data. From 2013 onwards, a question skip was introduced whenever the respondent says they use an indigenous language at home. This is not an issue because almost all indigenous language users had indigenous language-speaking parents. We can examine the 2005-2008 data to see this:

```{r}
dhs[is.element(year,2005:2008)] %T>% with(table(ethnic_self,ethnic_mom) %>% print) %>% with(table(ethnic_self,ethnic_dad))
```

### Residence history



### Body Mass Index

In this analysis, `bmi` is the dependent variable so we must exclude any cases without the measurement. Because we also want to evaluate trends over time and the relationship with ethnicity and history of migration,

```{r}
dhs[!(is.na(bmi)|bmi==9999)]
```

## Including Plots

You can also embed plots, for example:

```{r pressure, echo=FALSE}
plot(pressure)
```

Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
